Summary: blktap user space utilities
Name: blktap
Version: @BLKTAP_VERSION@
Release: @BLKTAP_RELEASE@
License: Proprietary
Group: System/Hypervisor
Source0: %{name}-%{version}.tar.bz2
Source1: block-vhd.o
Source2: block-vindex.o
Source3: io-optimize.o
Source4: td.o
Source5: tapdisk-queue.o
Source6: tapdisk-filter.o
Source7: libvhd.o
Source8: libvhd-journal.o
Source9: libvhd-index.o
Source10: vhd-util-coalesce.o
Source11: vhd-util-create.o
Source12: vhd-util-fill.o
Source13: vhd-util-query.o
Source14: vhd-util-read.o
Source15: vhd-util-repair.o
Source16: vhd-util-resize.o
Source17: vhd-util-set-field.o
Source18: vhd-util-snapshot.o
Source19: relative-path.o
Source20: vhd-util.o
Source21: vhd-index.o
Source22: vhd-update.o
Source23: tapdisk-vbd.o

Patch0: %{name}-development.patch
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-buildroot
Obsoletes: xen-blktap

%description
This package contains the blktap userspace utilities

%package devel
Summary: BlkTap Development Headers and Libraries
Requires: blktap = %{version}
Group: Development/Libraries
Obsoletes: xen-blktap

%description devel
This package contains the blktap development libraries and header files.

%prep
%setup -q
%patch0 -p1
cp %{SOURCE1} drivers
cp %{SOURCE2} drivers
cp %{SOURCE3} drivers
cp %{SOURCE4} drivers
cp %{SOURCE5} drivers
cp %{SOURCE6} drivers
cp %{SOURCE7} vhd/lib
cp %{SOURCE8} vhd/lib
cp %{SOURCE9} vhd/lib
cp %{SOURCE10} vhd/lib
cp %{SOURCE11} vhd/lib
cp %{SOURCE12} vhd/lib
cp %{SOURCE13} vhd/lib
cp %{SOURCE14} vhd/lib
cp %{SOURCE15} vhd/lib
cp %{SOURCE16} vhd/lib
cp %{SOURCE17} vhd/lib
cp %{SOURCE18} vhd/lib
cp %{SOURCE19} vhd/lib
cp %{SOURCE20} vhd
cp %{SOURCE21} vhd
cp %{SOURCE22} vhd
cp %{SOURCE23} drivers

%build
%{__make} USE_SYSTEM_LIBRARIES=y

%install
rm -rf $RPM_BUILD_ROOT
%{__make} install USE_SYSTEM_LIBRARIES=y DESTDIR=$RPM_BUILD_ROOT

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root,-)
%doc
%{_libdir}/libblktap.so.*
%{_libdir}/libvhd.so.*
%{_sbindir}/blktapctrl
%{_sbindir}/tapdisk
%{_sbindir}/td-util
%{_sbindir}/lock-util
%{_sbindir}/vhd-update
%{_sbindir}/vhd-util
%{_sbindir}/vhd-index
%{_sbindir}/tapdisk-client

%files devel
%defattr(-,root,root,-)
%doc
%{_includedir}/blktaplib.h
%{_libdir}/libblktap.a
%{_libdir}/libblktap.so
%{_libdir}/libvhd.a
%{_libdir}/libvhd.so

%changelog
